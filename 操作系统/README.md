* “王道”指王道2020操作系统复习指导
* “课本”指？？？？？？？？

## 计算机系统概述

### 操作系统的基本概念

操作系统的基本特征：并发、共享、虚拟、异步。其中**并发和共享**是操作系统的两个最基本的特征。并发和并行的区别。

**操作系统提供的用户接口**：
* 命令接口：用户输入命令来调用服务
  * 联机命令接口/交互式命令接口：适用于分时或实时系统，由一组键盘操作命令组成，比如Linux的控制台。
  * 脱机命令接口/批处理命令接口：适用于批处理系统，由一组作业控制命令/作业控制语句组成。
* 程序接口：程序中调用的接口
 * 由一组系统调用命令（系统调用/广义指令）组成，用户在程序中使用系通调用命令请求操作系统服务。
* GUI图形用户界面：通过调用系统调用命令实现，严格来说不是操作系统的一部分。

### 操作系统的发展与分类

#### 手工操作阶段

此阶段无操作系统

#### 批处理阶段

出现了操作系统，脱机使用计算机。
* 单道批处理系统：内存中始终保持一道作业。
* 多道批处理系统：由多道程序设计技术支持，宏观上并行，微观上串行。

#### 分时操作系统

把处理机的运行时间分成很短的时间片，轮流分给各联机作业，每个用户感觉自己独占了计算机。

也是支持多道程序设计技术的系统，但和多道批处理系统不同，它是人机交互的。

#### 实时操作系统

在某个时间限制内能完成某些紧急任务而不需要时间片排队。
* 硬实时系统：必须在规定时间内完成。
* 软实时系统：能接受偶尔违反时间规定且不会造成任何永久性损害。

#### 网络操作系统和分布式计算机系统

#### 个人计算机操作系统

王道P13选择题16，现代操作系统都是多任务操作系统，具有**并发和并行**的特点。

### 操作系统的运行环境

用户态/目态：运行用户程序。

内核态/核心态/管态：运行内核程序，执行一些特权指令，通常包括四个方面。
* 时钟管理：提供系统时间，通过时钟中断实现进程切换。
* 中断机制
* 原语：操作系统底层的小程序，具有原子性（Atomic Operation）。
* 系统控制的数据结构及处理：系统中登记状态的数据结构及进程、存储器、设备等的管理。

#### 中断和异常

见CMU笔记的note6中Exceptional Control Flow。
* 异步异常：中断，也叫外中断，**来自CPU执行指令以外的事件，与当前处理机运行的程序无关**，如IO中断、时钟中断。
* 同步异常：也叫内中断，来自CPU执行指令内部的事件。
  * traps：主动进行，**常用作系统调用（陷入指令/trap指令/访管指令，在用户态使用，故不可能是特权指令）**，还有特殊指令和断点等。
  * faults：非主动进行，有可能恢复，如虚拟内存的缺页、存储保护错误（访问越界）、浮点数运算错误等。
  * aborts：非主动进行，不可恢复，如非法操作码，奇偶校验错误等。

王道P20选择题9，计算机通过硬件中断机制完成用户态到核心态的转换。

### 操作系统的体系结构

大内核：将操作系统的主要功能模块作为整体运行在核心态，高性能。

微内核：将不需要在核心态执行的功能移入用户态，需要频繁切换核心态和用户态，性能不好，结构比单一内核稳定。

## 进程管理

### 进程与线程

#### 进程

Process Control Block进程控制块：描述进程的基本情况和运行态，是进程存在的唯一标志。

PCB包括：进程描述信息、进程控制和管理信息、资源分配清单、处理机相关信息/CPU现场信息。

程序段+相关数据+PCB = 进程映像/进程实体，创建和撤销进程就是创建和撤销PCB。

进程是操作系统资源分配和调度的基本单位（除CPU外）。

进程是动态的，程序是静态的。**动态性**是进程最基本的特征。

**五状态**，概念和转换图：
* 创建态：申请空白PCB写入基本信息，系统分配运行必需资源。
* 就绪态：进程获得了除处理机以外的所有资源。
* 运行态：正在处理机上运行。
* 阻塞态/等待态：等待输入输出或其他事件。
* 结束态：进程要结束运行时，要先被置为结束态，再进一步释放和回收资源。

进程控制：用到的程序叫**原语** —— 由内核提供，执行期间不允许中断。
* 进程创建：创建原语的内容。
* 进程终止：撤销原语/终止原语。
* 进程的阻塞和唤醒：阻塞是主动行为，阻塞原语，唤醒原语，**必须成对使用**。
* 进程切换

进程通信方式：
* 共享存储
* 消息传递
  * 直接通信：直接发送
  * 间接通信：发送给某个中间实体，信箱
* 管道通信：管道是连接读进程和写进程的共享文件，pipe文件，某一时刻只能单向传输。

#### 线程

进程的提出是为了提高并发度，线程的提出是为了减少并发的时空开销。

线程有独立id和线程控制块，有就绪、阻塞、运行三种基本状态。

线程是CPU分配的基本单位，系统调度和分派的基本单位。

线程实现方式（王道P37说明图）：
* 用户级线程：全部由应用程序完成，内核意识不到它的存在。
* 内核级线程：线程管理由内核完成，应用程序只有一个到内核级线程的编程接口。
* 组合方式：线程的创建、调度和同步在用户程序进行，用户级线程被映射到小于等于它个数的内核级线程上。

多线程模型：用户级线程和内核级线程的不同连接方式
* 多对一：用户级线程对操作系统不可见，内核操作仍为单线程，线程管理在用户空间进行，因而运行效率高。
* 一对一：并发能力强，但开销大。
* 多对多：n个用户级线程映射到m个内核级线程上，要求n>=m。

### 处理机调度

### 进程同步

### 死锁

## 内存管理

### 内存管理的概念

### 虚拟内存管理

## 文件管理

### 文件系统基础

### 文件系统实现

### 磁盘组织与管理

## IO管理

### IO管理概述

### IO核心子系统